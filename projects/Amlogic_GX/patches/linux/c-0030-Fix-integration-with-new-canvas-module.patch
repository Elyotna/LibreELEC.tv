From 67d429321caec4b6951a4f037b608387eb0ec491 Mon Sep 17 00:00:00 2001
From: Maxime Jourdan <mjourdan@baylibre.com>
Date: Fri, 24 Aug 2018 11:57:58 +0200
Subject: [PATCH 30/35] Fix integration with new canvas module

---
 drivers/media/platform/meson/vdec/codec_helpers.c | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/drivers/media/platform/meson/vdec/codec_helpers.c b/drivers/media/platform/meson/vdec/codec_helpers.c
index 14df767..4bdeae5 100644
--- a/drivers/media/platform/meson/vdec/codec_helpers.c
+++ b/drivers/media/platform/meson/vdec/codec_helpers.c
@@ -146,14 +146,19 @@ int amcodec_helper_set_canvases(struct amvdec_session *sess,
 	u32 reg_cur = reg_base[0];
 	u32 reg_num_cur = 0;
 	u32 reg_base_cur = 0;
+	int ret;
 
 	v4l2_m2m_for_each_dst_buf(sess->m2m_ctx, buf) {
 		switch (pixfmt) {
 		case V4L2_PIX_FMT_NV12M:
-			return codec_helper_set_canvas_nv12m(sess, &buf->vb.vb2_buf, width, height, reg_cur);
+			ret = codec_helper_set_canvas_nv12m(sess, &buf->vb.vb2_buf, width, height, reg_cur);
+			if (ret)
+				return ret;
 			break;
 		case V4L2_PIX_FMT_YUV420M:
-			return codec_helper_set_canvas_yuv420m(sess, &buf->vb.vb2_buf, width, height, reg_cur);
+			ret = codec_helper_set_canvas_yuv420m(sess, &buf->vb.vb2_buf, width, height, reg_cur);
+			if (ret)
+				return ret;
 			break;
 		default:
 			dev_err(sess->core->dev, "Unsupported pixfmt %08X\n",
-- 
2.7.4

